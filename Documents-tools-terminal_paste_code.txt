bash <(cat <<'EOS'
#!/usr/bin/env bash
# ==============================================
# Dolphin ServiceMenu: Documents Tools (PDF utils)
# Dependencies: poppler-utils (pdftotext, pdftoppm), kdialog
# ==============================================

BASE="$HOME/.local/share"
SERVICES="$BASE/kio/servicemenus"
SCRIPTS="$BASE/dolphin-scripts"

# === BLOK LOKALIZACJI ===
lang=${LANG:0:2}

say() {
  case $lang in
    pl) echo "$1" ;;
    de) echo "$2" ;;
    fr) echo "$3" ;;
    es) echo "$4" ;;
    it) echo "$5" ;;
    ru) echo "$6" ;;
    zh) echo "$7" ;;
    *)  echo "$1" ;;
  esac
}

ask_msg() {
  case $lang in
    pl) kdialog --msgbox "$1" ;;
    de) kdialog --msgbox "$2" ;;
    fr) kdialog --msgbox "$3" ;;
    es) kdialog --msgbox "$4" ;;
    it) kdialog --msgbox "$5" ;;
    ru) kdialog --msgbox "$6" ;;
    zh) kdialog --msgbox "$7" ;;
    *)  kdialog --msgbox "$1" ;;
  esac
}

ask_error() {
  case $lang in
    pl) kdialog --error "$1" ;;
    de) kdialog --error "$2" ;;
    fr) kdialog --error "$3" ;;
    es) kdialog --error "$4" ;;
    it) kdialog --error "$5" ;;
    ru) kdialog --error "$6" ;;
    zh) kdialog --error "$7" ;;
    *)  kdialog --error "$1" ;;
  esac
}

ask_input() {
  local default="$2"
  case $lang in
    pl) kdialog --inputbox "$1" "$default" ;;
    de) kdialog --inputbox "$3" "$default" ;;
    fr) kdialog --inputbox "$4" "$default" ;;
    es) kdialog --inputbox "$5" "$default" ;;
    it) kdialog --inputbox "$6" "$default" ;;
    ru) kdialog --inputbox "$7" "$default" ;;
    zh) kdialog --inputbox "$8" "$default" ;;
    *)  kdialog --inputbox "$1" "$default" ;;
  esac
}

install_all() {
  mkdir -p "$SERVICES" "$SCRIPTS"

  cat > "$SERVICES/Documents-Tools.desktop" <<EOF
[Desktop Entry]
Type=Service
ServiceTypes=KonqPopupMenu/Plugin
MimeType=application/pdf;
X-KDE-Submenu=Modify selected file
X-KDE-Submenu[pl]=Modyfikuj zaznaczony plik
X-KDE-Submenu[de]=Datei bearbeiten
X-KDE-Submenu[fr]=Modifier le fichier
X-KDE-Submenu[es]=Modificar archivo
X-KDE-Submenu[it]=Modifica file
X-KDE-Submenu[ru]=Ð˜Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ñ„Ð°Ð¹Ð»
X-KDE-Submenu[zh_CN]=ä¿®æ”¹æ–‡ä»¶
Actions=PdfToTxt;PdfToPng
Icon=application-pdf

[Desktop Action PdfToTxt]
Name=PDF â†’ TXT (text)
Name[pl]=PDF â†’ TXT (tekst)
Name[de]=PDF â†’ TXT (Text)
Name[fr]=PDF â†’ TXT (Texte)
Name[es]=PDF â†’ TXT (Texto)
Name[it]=PDF â†’ TXT (Testo)
Name[ru]=PDF â†’ TXT (Ð¢ÐµÐºÑÑ‚)
Name[zh_CN]=PDF â†’ TXT (æ–‡æœ¬)
Exec=$SCRIPTS/pdf-to-txt.sh %F
Icon=text-x-generic

[Desktop Action PdfToPng]
Name=PDF â†’ Images (PNG)
Name[pl]=PDF â†’ Obrazy (PNG)
Name[de]=PDF â†’ Bilder (PNG)
Name[fr]=PDF â†’ Images (PNG)
Name[es]=PDF â†’ ImÃ¡genes (PNG)
Name[it]=PDF â†’ Immagini (PNG)
Name[ru]=PDF â†’ Ð˜Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ (PNG)
Name[zh_CN]=PDF â†’ å›¾åƒ (PNG)
Exec=$SCRIPTS/pdf-to-png.sh %F
Icon=image-x-generic
EOF

  # --- Skrypt PDF â†’ TXT ---
  cat > "$SCRIPTS/pdf-to-txt.sh" <<'EOF2'
#!/usr/bin/env bash
lang=${LANG:0:2}

ask_error() {
  case $lang in
    pl) kdialog --error "âŒ Brak pdftotext (sudo apt install poppler-utils)" ;;
    de) kdialog --error "âŒ pdftotext fehlt (sudo apt install poppler-utils)" ;;
    fr) kdialog --error "âŒ pdftotext est manquant (sudo apt install poppler-utils)" ;;
    es) kdialog --error "âŒ Falta pdftotext (sudo apt install poppler-utils)" ;;
    it) kdialog --error "âŒ pdftotext mancante (sudo apt install poppler-utils)" ;;
    ru) kdialog --error "âŒ pdftotext Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚ (sudo apt install poppler-utils)" ;;
    zh) kdialog --error "âŒ ç¼ºå°‘ pdftotext (sudo apt install poppler-utils)" ;;
  esac
}

ask_msg() {
  case $lang in
    pl) kdialog --msgbox "âœ… PDF â†’ TXT zakoÅ„czone" ;;
    de) kdialog --msgbox "âœ… PDF â†’ TXT abgeschlossen" ;;
    fr) kdialog --msgbox "âœ… PDF â†’ TXT terminÃ©" ;;
    es) kdialog --msgbox "âœ… PDF â†’ TXT completado" ;;
    it) kdialog --msgbox "âœ… PDF â†’ TXT completato" ;;
    ru) kdialog --msgbox "âœ… PDF â†’ TXT Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾" ;;
    zh) kdialog --msgbox "âœ… PDF â†’ TXT å®Œæˆ" ;;
  esac
}

if ! command -v pdftotext &>/dev/null; then
  ask_error; exit 1
fi

for f in "$@"; do
  b="${f%.*}"
  pdftotext "$f" "${b}.txt"
done

ask_msg
EOF2

  # --- Skrypt PDF â†’ PNG ---
  cat > "$SCRIPTS/pdf-to-png.sh" <<'EOF2'
#!/usr/bin/env bash
lang=${LANG:0:2}

ask_error() {
  case $lang in
    pl) kdialog --error "âŒ Brak pdftoppm (sudo apt install poppler-utils)" ;;
    de) kdialog --error "âŒ pdftoppm fehlt (sudo apt install poppler-utils)" ;;
    fr) kdialog --error "âŒ pdftoppm est manquant (sudo apt install poppler-utils)" ;;
    es) kdialog --error "âŒ Falta pdftoppm (sudo apt install poppler-utils)" ;;
    it) kdialog --error "âŒ pdftoppm mancante (sudo apt install poppler-utils)" ;;
    ru) kdialog --error "âŒ pdftoppm Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚ (sudo apt install poppler-utils)" ;;
    zh) kdialog --error "âŒ ç¼ºå°‘ pdftoppm (sudo apt install poppler-utils)" ;;
  esac
}

ask_msg() {
  case $lang in
    pl) kdialog --msgbox "âœ… PDF â†’ PNG zakoÅ„czone (wynik w *_images)" ;;
    de) kdialog --msgbox "âœ… PDF â†’ PNG abgeschlossen (Ausgabe in *_images)" ;;
    fr) kdialog --msgbox "âœ… PDF â†’ PNG terminÃ© (rÃ©sultats dans *_images)" ;;
    es) kdialog --msgbox "âœ… PDF â†’ PNG completado (salida en *_images)" ;;
    it) kdialog --msgbox "âœ… PDF â†’ PNG completato (risultato in *_images)" ;;
    ru) kdialog --msgbox "âœ… PDF â†’ PNG Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾ (Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð² *_images)" ;;
    zh) kdialog --msgbox "âœ… PDF â†’ PNG å®Œæˆ (è¾“å‡ºåœ¨ *_images)" ;;
  esac
}

if ! command -v pdftoppm &>/dev/null; then
  ask_error; exit 1
fi

pages=$(kdialog --inputbox "Zakres stron (np. 1-5,10,22)" "1") || exit 0

for f in "$@"; do
  b="$(basename "${f%.*}")"
  dir="$(dirname "$f")"
  outdir="$dir/${b}_images"
  mkdir -p "$outdir"

  IFS=',' read -ra parts <<< "$pages"
  for p in "${parts[@]}"; do
    if [[ "$p" =~ - ]]; then
      from=$(echo "$p" | cut -d- -f1)
      to=$(echo "$p" | cut -d- -f2)
      pdftoppm -png -f "$from" -l "$to" "$f" "$outdir/page"
    else
      pdftoppm -png -f "$p" -l "$p" "$f" "$outdir/page"
    fi
  done
done

ask_msg
EOF2

  chmod +x "$SERVICES/Documents-Tools.desktop" "$SCRIPTS"/pdf-to-*.sh
  say "âœ… Zainstalowano narzÄ™dzia DokumentÃ³w (PDF)" \
      "âœ… Dokument-Tools installiert (PDF)" \
      "âœ… Outils Documents installÃ©s (PDF)" \
      "âœ… Herramientas Documentos instaladas (PDF)" \
      "âœ… Strumenti Documenti installati (PDF)" \
      "âœ… Ð˜Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹ PDF ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹" \
      "âœ… å·²å®‰è£…æ–‡æ¡£å·¥å…· (PDF)"
}

uninstall_all() {
  rm -f "$SERVICES/Documents-Tools.desktop" "$SCRIPTS"/pdf-to-*.sh
  say "ðŸ—‘ UsuniÄ™to narzÄ™dzia DokumentÃ³w (PDF)" \
      "ðŸ—‘ Dokument-Tools entfernt (PDF)" \
      "ðŸ—‘ Outils Documents supprimÃ©s (PDF)" \
      "ðŸ—‘ Herramientas Documentos eliminadas (PDF)" \
      "ðŸ—‘ Strumenti Documenti rimossi (PDF)" \
      "ðŸ—‘ Ð˜Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹ PDF ÑƒÐ´Ð°Ð»ÐµÐ½Ñ‹" \
      "ðŸ—‘ å·²åˆ é™¤æ–‡æ¡£å·¥å…· (PDF)"
}

# ==== MENU ====
say "ðŸ¬ Image Tools Installer  1 Instaluj, 2 Odinstaluj, 3 WyjÅ›cie" \
    "ðŸ¬ Bild-Tools Installer  1 Installieren, 2 Deinstallieren, 3 Beenden" \
    "ðŸ¬ Installateur Outils Image  1 Installer, 2 Supprimer, 3 Quitter" \
    "ðŸ¬ Instalador Herramientas Imagen  1 Instalar, 2 Desinstalar, 3 Salir" \
    "ðŸ¬ Installer Strumenti Immagine  1 Installa, 2 Rimuovi, 3 Esci" \
    "ðŸ¬ Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ñ‰Ð¸Ðº Ð˜Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð² Ð˜Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ð¹  1 Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ, 2 Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ, 3 Ð’Ñ‹Ñ…Ð¾Ð´" \
    "ðŸ¬ å›¾åƒå·¥å…·å®‰è£…ç¨‹åº  1 å®‰è£…, 2 å¸è½½, 3 é€€å‡º"

read -rp "ðŸ‘‰ " choice

case "$choice" in
  1) install_all ;;
  2) uninstall_all ;;
  3) exit 0 ;;
  *) say "âŒ NieprawidÅ‚owy wybÃ³r" \
         "âŒ UngÃ¼ltige Wahl" \
         "âŒ Choix invalide" \
         "âŒ OpciÃ³n invÃ¡lida" \
         "âŒ Scelta non valida" \
         "âŒ ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ð²Ñ‹Ð±Ð¾Ñ€" \
         "âŒ æ— æ•ˆçš„é€‰æ‹©"; exit 1 ;;
esac
EOS
)
