bash <(cat <<'EOS'
#!/usr/bin/env bash
# ==============================================
# Dolphin ServiceMenu: Image Tools (resize, ImageMagick)
# Dependencies: ImageMagick (magick/convert), kdialog
# ==============================================

BASE="$HOME/.local/share"
SERVICES="$BASE/kio/servicemenus"
SCRIPTS="$BASE/dolphin-scripts"

# === BLOK LOKALIZACJI ===
lang=${LANG:0:2}

say() {
  case $lang in
    pl) echo "$1" ;;
    de) echo "$2" ;;
    fr) echo "$3" ;;
    es) echo "$4" ;;
    it) echo "$5" ;;
    ru) echo "$6" ;;
    zh) echo "$7" ;;
    *)  echo "$1" ;;
  esac
}

ask_msg() {
  case $lang in
    pl) kdialog --msgbox "$1" ;;
    de) kdialog --msgbox "$2" ;;
    fr) kdialog --msgbox "$3" ;;
    es) kdialog --msgbox "$4" ;;
    it) kdialog --msgbox "$5" ;;
    ru) kdialog --msgbox "$6" ;;
    zh) kdialog --msgbox "$7" ;;
    *)  kdialog --msgbox "$1" ;;
  esac
}

ask_error() {
  case $lang in
    pl) kdialog --error "$1" ;;
    de) kdialog --error "$2" ;;
    fr) kdialog --error "$3" ;;
    es) kdialog --error "$4" ;;
    it) kdialog --error "$5" ;;
    ru) kdialog --error "$6" ;;
    zh) kdialog --error "$7" ;;
    *)  kdialog --error "$1" ;;
  esac
}

ask_input() {
  local default="$2"
  case $lang in
    pl) kdialog --inputbox "$1" "$default" ;;
    de) kdialog --inputbox "$3" "$default" ;;
    fr) kdialog --inputbox "$4" "$default" ;;
    es) kdialog --inputbox "$5" "$default" ;;
    it) kdialog --inputbox "$6" "$default" ;;
    ru) kdialog --inputbox "$7" "$default" ;;
    zh) kdialog --inputbox "$8" "$default" ;;
    *)  kdialog --inputbox "$1" "$default" ;;
  esac
}

install_all() {
  mkdir -p "$SERVICES" "$SCRIPTS"

  cat > "$SERVICES/Images-Tools.desktop" <<EOF
[Desktop Entry]
Type=Service
ServiceTypes=KonqPopupMenu/Plugin
MimeType=image/*
X-KDE-Submenu=Modify selected file
X-KDE-Submenu[pl]=Modyfikuj zaznaczony plik
X-KDE-Submenu[de]=Datei bearbeiten
X-KDE-Submenu[fr]=Modifier le fichier
X-KDE-Submenu[es]=Modificar archivo
X-KDE-Submenu[it]=Modifica file
X-KDE-Submenu[ru]=Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ñ„Ğ°Ğ¹Ğ»
X-KDE-Submenu[zh_CN]=ä¿®æ”¹æ–‡ä»¶
Actions=ResizePercent;ResizePx
Icon=image-x-generic

[Desktop Action ResizePercent]
Name=Scale (%)
Name[pl]=Skaluj (%)
Name[de]=Skalieren (%)
Name[fr]=Ã‰chelle (%)
Name[es]=Escalar (%)
Name[it]=Scala (%)
Name[ru]=ĞœĞ°ÑÑˆÑ‚Ğ°Ğ± (%)
Name[zh_CN]=ç¼©æ”¾ (%)
Exec=$SCRIPTS/image-resize-percent.sh %F
Icon=transform-scale

[Desktop Action ResizePx]
Name=Scale (px)
Name[pl]=Skaluj (px)
Name[de]=Skalieren (px)
Name[fr]=Ã‰chelle (px)
Name[es]=Escalar (px)
Name[it]=Scala (px)
Name[ru]=ĞœĞ°ÑÑˆÑ‚Ğ°Ğ± (px)
Name[zh_CN]=ç¼©æ”¾ (px)
Exec=$SCRIPTS/image-resize-pixels.sh %F
Icon=transform-scale
EOF

  # --- resize procentowy ---
  cat > "$SCRIPTS/image-resize-percent.sh" <<'EOF2'
#!/usr/bin/env bash
lang=${LANG:0:2}

ask_error() {
  case $lang in
    pl) kdialog --error "âŒ Brak ImageMagick" ;;
    de) kdialog --error "âŒ ImageMagick fehlt" ;;
    fr) kdialog --error "âŒ ImageMagick est manquant" ;;
    es) kdialog --error "âŒ Falta ImageMagick" ;;
    it) kdialog --error "âŒ ImageMagick mancante" ;;
    ru) kdialog --error "âŒ ĞÑ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ ImageMagick" ;;
    zh) kdialog --error "âŒ ç¼ºå°‘ ImageMagick" ;;
  esac
}

if ! command -v magick &>/dev/null && ! command -v convert &>/dev/null; then
  ask_error; exit 1
fi

scale=$(kdialog --inputbox "Procent (%)" "100") || exit 0

for f in "$@"; do
  b="${f%.*}"; ext="${f##*.}"
  if command -v magick &>/dev/null; then
    magick convert "$f" -resize ${scale}% "${b}_${scale}pct.${ext}"
  else
    convert "$f" -resize ${scale}% "${b}_${scale}pct.${ext}"
  fi
done

ask_msg "âœ… Skala ${scale}%" \
        "âœ… Skaliert ${scale}%" \
        "âœ… Mise Ã  l'Ã©chelle ${scale}%" \
        "âœ… Escalado ${scale}%" \
        "âœ… Scalato ${scale}%" \
        "âœ… ĞœĞ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾ ${scale}%" \
        "âœ… å·²ç¼©æ”¾ ${scale}%"
EOF2

  # --- resize w pikselach ---
  cat > "$SCRIPTS/image-resize-pixels.sh" <<'EOF2'
#!/usr/bin/env bash
lang=${LANG:0:2}

ask_error() {
  case $lang in
    pl) kdialog --error "âŒ Brak ImageMagick" ;;
    de) kdialog --error "âŒ ImageMagick fehlt" ;;
    fr) kdialog --error "âŒ ImageMagick est manquant" ;;
    es) kdialog --error "âŒ Falta ImageMagick" ;;
    it) kdialog --error "âŒ ImageMagick mancante" ;;
    ru) kdialog --error "âŒ ĞÑ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ ImageMagick" ;;
    zh) kdialog --error "âŒ ç¼ºå°‘ ImageMagick" ;;
  esac
}

if ! command -v magick &>/dev/null && ! command -v convert &>/dev/null; then
  ask_error; exit 1
fi

dims=$(kdialog --inputbox "Rozmiar np. 800x600" "800x600") || exit 0

for f in "$@"; do
  b="${f%.*}"; ext="${f##*.}"
  if command -v magick &>/dev/null; then
    magick convert "$f" -resize $dims "${b}_${dims}.${ext}"
  else
    convert "$f" -resize $dims "${b}_${dims}.${ext}"
  fi
done

ask_msg "âœ… Rozmiar $dims" \
        "âœ… GrÃ¶ÃŸe $dims" \
        "âœ… Taille $dims" \
        "âœ… TamaÃ±o $dims" \
        "âœ… Dimensioni $dims" \
        "âœ… Ğ Ğ°Ğ·Ğ¼ĞµÑ€ $dims" \
        "âœ… å¤§å° $dims"
EOF2

  chmod +x "$SERVICES/Images-Tools.desktop" "$SCRIPTS"/image-resize-*.sh
  say "âœ… Zainstalowano narzÄ™dzia Obrazy" \
      "âœ… Bild-Tools installiert" \
      "âœ… Outils Images installÃ©s" \
      "âœ… Herramientas de ImÃ¡genes instaladas" \
      "âœ… Strumenti Immagini installati" \
      "âœ… Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ´Ğ»Ñ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹" \
      "âœ… å·²å®‰è£…å›¾åƒå·¥å…·"
}

uninstall_all() {
  rm -f "$SERVICES/Images-Tools.desktop" "$SCRIPTS"/image-resize-*.sh
  say "ğŸ—‘ UsuniÄ™to narzÄ™dzia Obrazy" \
      "ğŸ—‘ Bild-Tools entfernt" \
      "ğŸ—‘ Outils Images supprimÃ©s" \
      "ğŸ—‘ Herramientas de ImÃ¡genes eliminadas" \
      "ğŸ—‘ Strumenti Immagini rimossi" \
      "ğŸ—‘ Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ´Ğ»Ñ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ñ‹" \
      "ğŸ—‘ å·²åˆ é™¤å›¾åƒå·¥å…·"
}

# ==== MENU ====
say "ğŸ¬ Image Tools Installer  1 Instaluj, 2 Odinstaluj, 3 WyjÅ›cie" \
    "ğŸ¬ Bild-Tools Installer  1 Installieren, 2 Deinstallieren, 3 Beenden" \
    "ğŸ¬ Installateur Outils Image  1 Installer, 2 Supprimer, 3 Quitter" \
    "ğŸ¬ Instalador Herramientas Imagen  1 Instalar, 2 Desinstalar, 3 Salir" \
    "ğŸ¬ Installer Strumenti Immagine  1 Installa, 2 Rimuovi, 3 Esci" \
    "ğŸ¬ Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ñ‰Ğ¸Ğº Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹  1 Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ, 2 Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ, 3 Ğ’Ñ‹Ñ…Ğ¾Ğ´" \
    "ğŸ¬ å›¾åƒå·¥å…·å®‰è£…ç¨‹åº  1 å®‰è£…, 2 å¸è½½, 3 é€€å‡º"

read -rp "ğŸ‘‰ " choice

case "$choice" in
  1) install_all ;;
  2) uninstall_all ;;
  3) exit 0 ;;
  *) say "âŒ NieprawidÅ‚owy wybÃ³r" \
         "âŒ UngÃ¼ltige Wahl" \
         "âŒ Choix invalide" \
         "âŒ OpciÃ³n invÃ¡lida" \
         "âŒ Scelta non valida" \
         "âŒ ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€" \
         "âŒ æ— æ•ˆçš„é€‰æ‹©"; exit 1 ;;
esac
EOS
)
