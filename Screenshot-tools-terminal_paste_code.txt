bash <(cat <<'EOS'
#!/usr/bin/env bash
# ==============================================
# Dolphin ServiceMenu: Take Screenshot & Save Here
# Zapisuje screenshot (obszar / caÅ‚y ekran / aktywne okno)
# bezpoÅ›rednio do wybranego folderu w Dolphin
# Dependencies: spectacle, kdialog, xclip/xsel
# ==============================================

BASE="$HOME/.local/share"
SERVICES="$BASE/kio/servicemenus"
SCRIPTS="$BASE/dolphin-scripts"

lang=${LANG:0:2}

say() {
  case $lang in
    pl) echo "$1" ;;
    de) echo "$2" ;;
    fr) echo "$3" ;;
    es) echo "$4" ;;
    it) echo "$5" ;;
    ru) echo "$6" ;;
    zh) echo "$7" ;;
    *)  echo "$1" ;;
  esac
}

install_all() {
  mkdir -p "$SERVICES" "$SCRIPTS"

  # --- Desktop Entry ---
  cat > "$SERVICES/Take-Screenshot.desktop" <<EOF
[Desktop Entry]
Type=Service
ServiceTypes=KonqPopupMenu/Plugin
MimeType=inode/directory;
Actions=PasteScreenshot
Icon=camera-photo

[Desktop Action PasteScreenshot]
Name=Take screenshot and paste here
Name[pl]=ZrÃ³b zrzut ekranu i wklej tutaj
Name[de]=Screenshot erstellen und hier einfÃ¼gen
Name[fr]=Prendre une capture et coller ici
Name[es]=Hacer captura y pegar aquÃ­
Name[it]=Cattura schermo e incolla qui
Name[ru]=Ğ¡Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ ÑĞºÑ€Ğ¸Ğ½ÑˆĞ¾Ñ‚ Ğ¸ Ğ²ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑÑĞ´Ğ°
Name[zh_CN]=æˆªå›¾å¹¶ç²˜è´´åˆ°æ­¤å¤„
Exec=$SCRIPTS/paste-screenshot.sh %f
Icon=camera-photo
EOF

  # --- Script paste-screenshot.sh ---
  cat > "$SCRIPTS/paste-screenshot.sh" <<'EOF2'
#!/usr/bin/env bash
# Script: paste-screenshot.sh
lang=${LANG:0:2}
target="$1"

if [ -z "$target" ] || [ "$target" = "." ]; then
  outdir="$(pwd)"
elif [ -d "$target" ]; then
  outdir="$target"
else
  outdir="$(dirname "$target")"
fi

mkdir -p "$outdir"
outfile="$outdir/Screenshot_$(date +'%Y-%m-%d_%H-%M-%S').png"

if ! command -v spectacle &>/dev/null; then
  case $lang in
    pl) kdialog --error "âŒ Brak Spectacle (sudo apt install spectacle)" ;;
    de) kdialog --error "âŒ Spectacle fehlt (sudo apt install spectacle)" ;;
    fr) kdialog --error "âŒ Spectacle est manquant (sudo apt install spectacle)" ;;
    es) kdialog --error "âŒ Falta Spectacle (sudo apt install spectacle)" ;;
    it) kdialog --error "âŒ Spectacle mancante (sudo apt install spectacle)" ;;
    ru) kdialog --error "âŒ Spectacle Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ (sudo apt install spectacle)" ;;
    zh) kdialog --error "âŒ ç¼ºå°‘ Spectacle (å®‰è£…: sudo apt install spectacle)" ;;
    *)  kdialog --error "âŒ Spectacle not found" ;;
  esac
  exit 1
fi

# Teksty menu screena
case $lang in
  pl) title="Tryb zrzutu ekranu"; opt_area="Obszar"; opt_full="PeÅ‚ny ekran"; opt_window="Aktywne okno" ;;
  de) title="Screenshot-Modus"; opt_area="Bereich"; opt_full="Vollbild"; opt_window="Aktives Fenster" ;;
  fr) title="Mode de capture"; opt_area="Zone"; opt_full="Ã‰cran complet"; opt_window="FenÃªtre active" ;;
  es) title="Modo de captura"; opt_area="Ãrea"; opt_full="Pantalla completa"; opt_window="Ventana activa" ;;
  it) title="ModalitÃ  screenshot"; opt_area="Area"; opt_full="Schermo intero"; opt_window="Finestra attiva" ;;
  ru) title="Ğ ĞµĞ¶Ğ¸Ğ¼ ÑĞ½Ğ¸Ğ¼ĞºĞ° ÑĞºÑ€Ğ°Ğ½Ğ°"; opt_area="ĞĞ±Ğ»Ğ°ÑÑ‚ÑŒ"; opt_full="Ğ’ĞµÑÑŒ ÑĞºÑ€Ğ°Ğ½"; opt_window="ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğµ Ğ¾ĞºĞ½Ğ¾" ;;
  zh) title="æˆªå›¾æ¨¡å¼"; opt_area="åŒºåŸŸ"; opt_full="å…¨å±"; opt_window="æ´»åŠ¨çª—å£" ;;
  *)  title="Screenshot mode"; opt_area="Area"; opt_full="Full screen"; opt_window="Active window" ;;
esac

choice=$(kdialog --menu "$title" \
  area "$opt_area" \
  full "$opt_full" \
  window "$opt_window") || exit 0

case $choice in
  area)
    spectacle -r -b -c
    if command -v xclip &>/dev/null; then
      xclip -selection clipboard -t image/png -o > "$outfile" 2>/dev/null
    elif command -v xsel &>/dev/null; then
      xsel --clipboard -t image/png -o > "$outfile" 2>/dev/null
    fi
    ;;
  full)
    spectacle -f -b -o "$outfile"
    ;;
  window)
    spectacle -a -b -o "$outfile"
    ;;
esac

if [ -s "$outfile" ]; then
  case $lang in
    pl) kdialog --msgbox "âœ… Zrzut ekranu zapisany:\n$outfile" ;;
    de) kdialog --msgbox "âœ… Screenshot gespeichert:\n$outfile" ;;
    fr) kdialog --msgbox "âœ… Capture enregistrÃ©e :\n$outfile" ;;
    es) kdialog --msgbox "âœ… Captura guardada:\n$outfile" ;;
    it) kdialog --msgbox "âœ… Screenshot salvato:\n$outfile" ;;
    ru) kdialog --msgbox "âœ… Ğ¡ĞºÑ€Ğ¸Ğ½ÑˆĞ¾Ñ‚ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½:\n$outfile" ;;
    zh) kdialog --msgbox "âœ… æˆªå›¾å·²ä¿å­˜:\n$outfile" ;;
    *)  kdialog --msgbox "âœ… Screenshot saved:\n$outfile" ;;
  esac
else
  case $lang in
    pl) kdialog --error "âŒ Nie udaÅ‚o siÄ™ wykonaÄ‡ zrzutu" ;;
    de) kdialog --error "âŒ Screenshot fehlgeschlagen" ;;
    fr) kdialog --error "âŒ Capture Ã©chouÃ©e" ;;
    es) kdialog --error "âŒ Error al tomar captura" ;;
    it) kdialog --error "âŒ Acquisizione fallita" ;;
    ru) kdialog --error "âŒ ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞºÑ€Ğ¸Ğ½ÑˆĞ¾Ñ‚Ğ°" ;;
    zh) kdialog --error "âŒ æˆªå›¾å¤±è´¥" ;;
    *)  kdialog --error "âŒ Screenshot failed" ;;
  esac
fi
EOF2

  chmod +x "$SERVICES/Take-Screenshot.desktop" "$SCRIPTS"/paste-screenshot.sh
  say "âœ… Zainstalowano narzÄ™dzie Take-Screenshot" \
      "âœ… Screenshot-Tool installiert" \
      "âœ… Outil Capture installÃ©" \
      "âœ… Herramienta Captura instalada" \
      "âœ… Strumento Screenshot installato" \
      "âœ… Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚ Ğ¡ĞºÑ€Ğ¸Ğ½ÑˆĞ¾Ñ‚Ğ¾Ğ² ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½" \
      "âœ… å·²å®‰è£…æˆªå›¾å·¥å…·"
}

uninstall_all() {
  rm -f "$SERVICES/Take-Screenshot.desktop" "$SCRIPTS"/paste-screenshot.sh
  say "ğŸ—‘ UsuniÄ™to narzÄ™dzie Take-Screenshot" \
      "ğŸ—‘ Screenshot-Tool entfernt" \
      "ğŸ—‘ Outil Capture supprimÃ©" \
      "ğŸ—‘ Herramienta Captura eliminada" \
      "ğŸ—‘ Strumento Screenshot rimosso" \
      "ğŸ—‘ Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚ Ğ¡ĞºÑ€Ğ¸Ğ½ÑˆĞ¾Ñ‚Ğ¾Ğ² ÑƒĞ´Ğ°Ğ»Ñ‘Ğ½" \
      "ğŸ—‘ å·²åˆ é™¤æˆªå›¾å·¥å…·"
}

# ==== MENU INSTALL/REMOVE ====
say "ğŸ¬ Instalator Screenshot  1 Instaluj, 2 Odinstaluj, 3 WyjÅ›cie" \
    "ğŸ¬ Screenshot Installer  1 Installieren, 2 Deinstallieren, 3 Beenden" \
    "ğŸ¬ Installateur Capture  1 Installer, 2 Supprimer, 3 Quitter" \
    "ğŸ¬ Instalador Captura  1 Instalar, 2 Desinstalar, 3 Salir" \
    "ğŸ¬ Installer Screenshot  1 Installa, 2 Rimuovi, 3 Esci" \
    "ğŸ¬ Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ñ‰Ğ¸Ğº Ğ¡ĞºÑ€Ğ¸Ğ½ÑˆĞ¾Ñ‚Ğ¾Ğ²  1 Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ, 2 Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ, 3 Ğ’Ñ‹Ñ…Ğ¾Ğ´" \
    "ğŸ¬ æˆªå›¾å·¥å…·å®‰è£…ç¨‹åº  1 å®‰è£…, 2 å¸è½½, 3 é€€å‡º"

read -rp "ğŸ‘‰ " choice

case "$choice" in
  1) install_all ;;
  2) uninstall_all ;;
  3) exit 0 ;;
  *) say "âŒ NieprawidÅ‚owy wybÃ³r" \
         "âŒ UngÃ¼ltige Wahl" \
         "âŒ Choix invalide" \
         "âŒ OpciÃ³n invÃ¡lida" \
         "âŒ Scelta non valida" \
         "âŒ ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€" \
         "âŒ æ— æ•ˆçš„é€‰æ‹©"; exit 1 ;;
esac
EOS
)
